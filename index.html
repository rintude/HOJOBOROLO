<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤ - Moto HD</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root {
            --wa-teal: #075E54;
            --wa-green: #25D366;
            --wa-bg: #e5ddd5;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

        body { margin: 0; background-color: #d1d7db; display: flex; justify-content: center; height: 100vh; overflow: hidden; }

        /* ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® */
        #splash-screen {
            position: fixed; inset: 0; background: white;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10000; transition: opacity 0.5s;
        }

        .app-container {
            width: 100%; max-width: 500px; height: 100vh;
            background: var(--wa-bg); display: flex; flex-direction: column; position: relative;
        }

        header {
            background: var(--wa-teal); padding: 15px; color: white;
            display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 10;
        }

        .screen { display: none; flex-direction: column; height: calc(100vh - 60px); }
        .active { display: flex; }

        /* ‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡¶ï‡ßç‡¶∏ */
        .login-box { margin: auto; width: 85%; background: white; padding: 25px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; outline: none; }
        .start-btn { width: 100%; padding: 12px; background: var(--wa-green); color: white; border: none; font-weight: bold; border-radius: 5px; cursor: pointer; }

        /* ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
        .video-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 10px; background: #000; }
        video { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; background: #222; }

        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
        #chat-content {
            flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
        }
        .msg { max-width: 80%; margin-bottom: 8px; padding: 8px 12px; border-radius: 10px; font-size: 14px; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
        .msg-you { align-self: flex-end; background: #dcf8c6; }
        .msg-them { align-self: flex-start; background: #ffffff; }

        /* ‡¶ï‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ (‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£) */
        .call-controls {
            background: #f0f0f0; padding: 15px; border-top: 1px solid #ddd;
        }
        
        .message-input-row { display: flex; gap: 8px; margin-bottom: 15px; }
        .message-input-row input { margin: 0; border-radius: 25px; border: none; padding: 12px 20px; }
        .send-btn { width: 45px; height: 45px; background: var(--wa-teal); border: none; border-radius: 50%; color: white; cursor: pointer; }

        .action-buttons-row {
            display: flex; justify-content: space-between; align-items: center;
        }

        .control-btn {
            flex: 1; margin: 0 5px; padding: 12px 5px; border: none; border-radius: 8px;
            font-size: 13px; font-weight: bold; cursor: pointer; color: white;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }

        .btn-mic { background-color: #4f5b62; }
        .btn-cam { background-color: #4f5b62; }
        .btn-hangup { background-color: #ea0038; } /* ‡¶≤‡¶ø‡¶≠ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡¶æ‡¶≤ ‡¶∞‡¶ô‡ßá‡¶∞ */

        .off { background-color: #ff9800 !important; } /* ‡¶Ö‡¶´ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡¶¨‡ßá */

    </style>
</head>
<body>

<div id="splash-screen">
    <div style="font-size: 50px; background: var(--wa-teal); color: white; width: 80px; height: 80px; display: flex; justify-content: center; align-items: center; border-radius: 20px;">‡¶π</div>
    <h2 style="color: #555;">‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤</h2>
</div>

<div class="app-container">
    <header>
        <div style="font-weight: bold; font-size: 20px;">‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤</div>
    </header>

    <div id="login-screen" class="screen active">
        <div class="login-box">
            <h3>Moto HD ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶®</h3>
            <input type="text" id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <input type="text" id="room-id" placeholder="‡¶∞‡ßÅ‡¶Æ ‡¶Ü‡¶á‡¶°‡¶ø (ID)">
            <button class="start-btn" onclick="joinRoom()">‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="main-screen" class="screen">
        <div class="video-grid">
            <video id="local-video" autoplay muted playsinline></video>
            <video id="remote-video" autoplay playsinline></video>
        </div>

        <div id="chat-content"></div>

        <div class="call-controls">
            <div class="message-input-row">
                <input type="text" id="msg-input" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                <button class="send-btn" onclick="sendMessage()">‚û§</button>
            </div>

            <div class="action-buttons-row">
                <button id="mic-btn" class="control-btn btn-mic" onclick="toggleMic()">
                    <span>üé§</span> ‡¶Æ‡¶æ‡¶á‡¶ï ‡¶Ö‡¶®
                </button>
                <button id="cam-btn" class="control-btn btn-cam" onclick="toggleVideo()">
                    <span>üì∑</span> ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ö‡¶®
                </button>
                <button class="control-btn btn-hangup" onclick="exitRoom()">
                    <span>üìû</span> ‡¶≤‡¶ø‡¶≠ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠
    setTimeout(() => {
        const splash = document.getElementById('splash-screen');
        splash.style.opacity = '0';
        setTimeout(() => splash.remove(), 500);
    }, 2000);

    let peer, localStream, conn;
    let isMicOn = true;
    let isCamOn = true;

    function joinRoom() {
        const name = document.getElementById('username').value;
        const room = document.getElementById('room-id').value;
        if (!name || !room) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");

        peer = new Peer('hjb-' + room);

        peer.on('open', () => {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('main-screen').classList.add('active');
            startMedia();
        });

        peer.on('error', (err) => {
            if(err.type === 'unavailable-id') connectAsGuest('hjb-' + room);
        });

        peer.on('call', call => {
            call.answer(localStream);
            call.on('stream', stream => {
                document.getElementById('remote-video').srcObject = stream;
            });
        });

        peer.on('connection', c => {
            conn = c;
            conn.on('data', data => appendMsg(data, false));
        });
    }

    function connectAsGuest(id) {
        peer = new Peer('hjb-guest-' + Math.floor(Math.random()*999));
        peer.on('open', () => {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('main-screen').classList.add('active');
            startMedia().then(() => {
                const call = peer.call(id, localStream);
                call.on('stream', stream => {
                    document.getElementById('remote-video').srcObject = stream;
                });
                conn = peer.connect(id);
                conn.on('data', data => appendMsg(data, false));
            });
        });
    }

    async function startMedia() {
        try {
            localStream = await navigator.mediaDevices.getUserMedia({video: true, audio: true});
            document.getElementById('local-video').srcObject = localStream;
        } catch(e) { alert("‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ/‡¶Æ‡¶æ‡¶á‡¶ï ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡¶ø‡¶®"); }
    }

    // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
    function sendMessage() {
        const inp = document.getElementById('msg-input');
        if(conn && inp.value.trim() !== "") {
            conn.send(inp.value);
            appendMsg(inp.value, true);
            inp.value = "";
        }
    }

    function appendMsg(txt, isMe) {
        const div = document.createElement('div');
        div.className = isMe ? "msg msg-you" : "msg msg-them";
        div.innerText = txt;
        const box = document.getElementById('chat-content');
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    // ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶® ‡¶Ö‡¶®/‡¶Ö‡¶´ (Audio Mute/Unmute)
    function toggleMic() {
        isMicOn = !isMicOn;
        localStream.getAudioTracks()[0].enabled = isMicOn;
        const btn = document.getElementById('mic-btn');
        btn.innerHTML = isMicOn ? "<span>üé§</span> ‡¶Æ‡¶æ‡¶á‡¶ï ‡¶Ö‡¶®" : "<span>üîá</span> ‡¶Æ‡¶ø‡¶â‡¶ü";
        btn.classList.toggle('off', !isMicOn);
    }

    // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ö‡¶®/‡¶Ö‡¶´ (Video On/Off)
    function toggleVideo() {
        isCamOn = !isCamOn;
        localStream.getVideoTracks()[0].enabled = isCamOn;
        const btn = document.getElementById('cam-btn');
        btn.innerHTML = isCamOn ? "<span>üì∑</span> ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ö‡¶®" : "<span>üö´</span> ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ö‡¶´";
        btn.classList.toggle('off', !isCamOn);
    }

    // ‡¶≤‡¶ø‡¶≠ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü (Exit Room)
    function exitRoom() {
        if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶ï‡¶≤‡¶ü‡¶ø ‡¶ï‡ßá‡¶ü‡ßá ‡¶¶‡¶ø‡ßü‡ßá ‡¶¨‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
            location.reload(); // ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶¨‡ßá
        }
    }
</script>

</body>
</html>
