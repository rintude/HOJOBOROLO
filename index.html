<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ | Multi-user Video Chat</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,sans-serif;background:#0b0b12;color:#fff}
header{padding:15px;text-align:center;font-size:24px;font-weight:700;background:linear-gradient(90deg,#ff004c,#ff7b00)}
.container{max-width:900px;margin:auto;padding:15px}
.card{background:#151521;border-radius:14px;padding:16px;margin-bottom:16px}
input,button{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:none;font-size:16px}
input{background:#0f0f18;color:#fff}
button{background:linear-gradient(90deg,#ff004c,#ff7b00);color:#fff;font-weight:600;cursor:pointer}
button.secondary{background:linear-gradient(90deg,#0077ff,#00e0ff)}
button.danger{background:#ff0033}
.chat{height:200px;overflow-y:auto;background:#0f0f18;border-radius:10px;padding:10px;margin-bottom:10px}
video{width:100%;max-height:220px;background:#000;border-radius:12px;margin-top:10px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
@media(max-width:600px){.controls{flex-direction:column}}
footer{text-align:center;font-size:12px;opacity:.6;padding:10px}
</style>
</head>
<body>

<header>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ | Multi-user Video Chat</header>

<div class="container">

<!-- LOGIN CARD -->
<div class="card" id="login">
<input id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
<input id="roomCode" placeholder="‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶ï‡ßã‡¶°">
<button id="createBtn">‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<button class="secondary" id="joinBtn">‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<!-- CHAT CARD -->
<div class="card" id="chatCard" style="display:none">
<div class="chat" id="chat"></div>
<input id="msg" placeholder="‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
<button id="sendBtn">‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
</div>

<!-- VIDEO CARD -->
<div class="card" id="callCard" style="display:none">
<video id="myVideo" autoplay muted playsinline></video>
<video id="remoteVideo" autoplay playsinline></video>
<div class="controls">
<button id="micBtn">‡¶Æ‡¶æ‡¶á‡¶ï</button>
<button id="camBtn">‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</button>
<button class="danger" id="leaveBtn">‡¶¨‡ßá‡¶∞‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®</button>
</div>
</div>

</div>

<footer>¬© 2025 ‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ | ‡¶¨‡¶æ‡¶¨‡¶æ‡¶á</footer>

<script>
let peer, conn, call;
let localStream;
let myName="", peerName="";
let isHost=false;

/* Utility */
function log(t){
  chat.innerHTML += `<div>${t}</div>`;
  chat.scrollTop = chat.scrollHeight;
}

/* Media Init */
async function initMedia(){
  if(localStream) return;
  try {
    localStream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
    myVideo.srcObject = localStream;
  } catch(e){
    alert("Camera/Mic access denied! "+e.message);
  }
}

/* Enter UI */
function enterUI(){
  login.style.display="none";
  chatCard.style.display="block";
  callCard.style.display="block";
}

/* Setup Connection */
function setupConn(){
  if(!conn) return;
  conn.on("data", d => log(`<b>${d.name}:</b> ${d.msg}`));
  conn.on("close", ()=>{
    alert(peerName+" ‡¶∞‡ßÅ‡¶Æ ‡¶õ‡ßá‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá");
    log("üî¥ "+peerName+" ‡¶∞‡ßÅ‡¶Æ ‡¶õ‡ßá‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá");
  });
}

/* Chat Send */
function sendMsg(){
  if(!conn || !msg.value) return;
  conn.send({name:myName, msg:msg.value});
  log("<b>‡¶Ü‡¶Æ‡¶ø:</b> "+msg.value);
  msg.value="";
}

/* Buttons */
document.getElementById("createBtn").onclick = async ()=>{
  if(!username.value || !roomCode.value){ alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®"); return; }
  myName = username.value;
  isHost = true;
  await initMedia();

  peer = new Peer(roomCode.value,{
    config:{
      iceServers:[
        {urls:"stun:stun.l.google.com:19302"},
        {urls:"stun:stun1.l.google.com:19302"},
        {urls:"turn:numb.viagenie.ca", credential:"muazkh", username:"webrtc@live.com"}
      ]
    }
  });

  peer.on("open", ()=>{ enterUI(); log("üü¢ ‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá"); });

  peer.on("connection", c=>{
    conn = c;
    peerName = c.metadata?.name || "‡¶è‡¶ï‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞";
    alert(peerName+" ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá");
    log("üü° "+peerName+" ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá");
    setupConn();
    // Auto call
    call = peer.call(conn.peer, localStream);
    call.on("stream", s=>remoteVideo.srcObject = s);
  });

  peer.on("call", c=>{
    call = c;
    c.answer(localStream);
    c.on("stream", s=>remoteVideo.srcObject = s);
  });
};

document.getElementById("joinBtn").onclick = async ()=>{
  if(!username.value || !roomCode.value){ alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®"); return; }
  myName = username.value;
  await initMedia();

  peer = new Peer({
    config:{
      iceServers:[
        {urls:"stun:stun.l.google.com:19302"},
        {urls:"stun:stun1.l.google.com:19302"},
        {urls:"turn:numb.viagenie.ca", credential:"muazkh", username:"webrtc@live.com"}
      ]
    }
  });

  peer.on("open", ()=>{
    conn = peer.connect(roomCode.value,{metadata:{name:myName}});
    conn.on("open", ()=>{ enterUI(); log("üü¢ ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá"); });
    setupConn();
  });

  peer.on("call", c=>{
    call = c;
    c.answer(localStream);
    c.on("stream", s=>remoteVideo.srcObject = s);
  });
};

/* Control Buttons */
document.getElementById("sendBtn").onclick = sendMsg;
document.getElementById("micBtn").onclick = ()=>{ if(localStream)localStream.getAudioTracks()[0].enabled^=1; };
document.getElementById("camBtn").onclick = ()=>{ if(localStream)localStream.getVideoTracks()[0].enabled^=1; };
document.getElementById("leaveBtn").onclick = ()=>{
  if(call) call.close();
  if(conn) conn.close();
  if(peer) peer.destroy();
  location.reload();
};
</script>

</body>
</html>
