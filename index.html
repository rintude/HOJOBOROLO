<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ - ‡¶™‡ßç‡¶∞‡ßã</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root {
            --wa-dark: #0b141a;
            --wa-green: #00a884;
            --gold: #FFD700;
            --clay: #8B4513;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--wa-dark); color: white;
        }

        /* ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® */
        #splash {
            position: fixed; inset: 0; background: #000;
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000;
        }
        .logo { font-size: 50px; color: var(--gold); font-weight: bold; animation: glow 1.5s infinite; }
        @keyframes glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        #login-container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; padding: 20px; text-align: center;
        }
        .input-group { width: 100%; max-width: 300px; margin-bottom: 15px; }
        input { 
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--clay);
            background: #2a3942; color: white; outline: none;
        }

        /* ‡¶Æ‡ßá‡¶á‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶´‡ßá‡¶∏ */
        #app-main { display: none; height: 100vh; grid-template-columns: 350px 1fr; }

        /* ‡¶∏‡¶æ‡¶á‡¶°‡¶¨‡¶æ‡¶∞ (‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü) */
        .sidebar { background: #111b21; border-right: 1px solid #2a3942; display: flex; flex-direction: column; }
        .sidebar-header { background: #202c33; padding: 15px; display: flex; justify-content: space-between; align-items: center; color: var(--gold); }
        .contact-list { overflow-y: auto; flex: 1; }
        .contact-item { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .contact-item:hover { background: #2a3942; }
        .avatar { width: 45px; height: 45px; background: var(--clay); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã */
        .chat-window { display: flex; flex-direction: column; background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-blend-mode: overlay; background-color: #0b141a; }
        .chat-header { background: #202c33; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #333; }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 70%; padding: 8px 15px; border-radius: 10px; font-size: 14px; }
        .msg.sent { align-self: flex-end; background: #005c4b; }
        .msg.received { align-self: flex-start; background: #202c33; }

        /* ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ó‡ßç‡¶∞‡¶ø‡¶° */
        #video-grid { display: none; position: absolute; inset: 0; background: #000; z-index: 500; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; padding: 10px; }
        video { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; background: #222; border: 2px solid var(--gold); }

        /* ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
        .input-area { background: #202c33; padding: 10px; display: flex; gap: 10px; align-items: center; }
        .btn-round { background: var(--wa-green); border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; color: white; font-size: 20px; }
        .call-btn { background: #34b7f1; }
        .exit-btn { background: #ea0038; }

        /* ‡¶∞‡ßá‡¶∏‡ßç‡¶™‡¶®‡ßç‡¶∏‡¶ø‡¶≠ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ */
        @media (max-width: 768px) {
            #app-main { grid-template-columns: 1fr; }
            .sidebar { display: block; }
            .chat-window { display: none; }
            .active-chat .sidebar { display: none; }
            .active-chat .chat-window { display: flex; }
        }
    </style>
</head>
<body>

<div id="splash"><div class="logo">‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</div><p style="color:var(--clay)">‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®: ‡¶¨‡¶æ‡¶¨‡¶æ‡¶á</p></div>

<div id="login-container">
    <h2 style="color:var(--gold)">‡¶≤‡¶ó‡¶á‡¶® (OTP)</h2>
    <div id="recaptcha-container"></div>
    <div class="input-group">
        <input type="text" id="phone" placeholder="+88017xxxxxxxx">
    </div>
    <button onclick="sendOTP()" id="send-btn" style="padding:10px 30px; background:var(--wa-green); border:none; color:white; border-radius:5px; cursor:pointer;">OTP ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
    
    <div id="otp-group" style="display:none; margin-top:15px;">
        <input type="text" id="otp" placeholder="‡ß¨ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®">
        <button onclick="verifyOTP()" style="margin-top:10px; background:var(--gold); color:black; border:none; padding:10px 20px; border-radius:5px; font-weight:bold;">‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<div id="app-main">
    <div class="sidebar">
        <div class="sidebar-header">
            <span>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü</span>
            <button onclick="location.reload()" style="background:none; border:none; color:var(--gold); cursor:pointer;">Log out</button>
        </div>
        <div class="contact-list" id="contacts">
            <div class="contact-item" onclick="openChat('Group Chat')">
                <div class="avatar">G</div>
                <div><strong>‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</strong><br><small>‡¶∏‡¶¨‡¶æ‡¶á ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá</small></div>
            </div>
        </div>
    </div>

    <div class="chat-window" id="chat-window">
        <div class="chat-header">
            <div style="display:flex; align-items:center; gap:10px;">
                <div class="avatar" id="current-chat-avatar">G</div>
                <strong id="current-chat-name">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</strong>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn-round call-btn" onclick="startVideoCall()">üìû</button>
                <button class="btn-round exit-btn" onclick="closeChat()">‚úñ</button>
            </div>
        </div>

        <div class="chat-messages" id="messages">
            <div class="msg received">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! "‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤" ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>
        </div>

        <div class="input-area">
            <input type="text" id="msg-input" placeholder="‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." style="flex:1;">
            <button class="btn-round" onclick="sendMessage()">‚ûî</button>
        </div>
    </div>

    <div id="video-grid">
        <video id="local-video" autoplay muted playsinline></video>
        <div style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px;">
            <button class="btn-round exit-btn" onclick="endCall()" title="‡¶ï‡¶≤ ‡¶∂‡ßá‡¶∑">üìû</button>
            <button class="btn-round" onclick="toggleMic()" style="background:#444">üé§</button>
            <button class="btn-round" onclick="toggleCam()" style="background:#444">üì∑</button>
        </div>
    </div>
</div>

<script>
    // Firebase Configuration (‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ Firebase Credentials ‡¶¶‡¶ø‡¶≤‡ßá ‡¶Ü‡¶∏‡¶≤ OTP ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠
    setTimeout(() => document.getElementById('splash').style.display = 'none', 2500);

    let confirmationResult;
    let myStream;
    let peer;

    // ‡ßß. OTP ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function sendOTP() {
        const phone = document.getElementById('phone').value;
        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');
        auth.signInWithPhoneNumber(phone, window.recaptchaVerifier)
            .then(result => {
                confirmationResult = result;
                document.getElementById('otp-group').style.display = 'block';
                document.getElementById('send-btn').style.display = 'none';
                alert("‡¶ì‡¶ü‡¶ø‡¶™‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            }).catch(err => alert(err.message));
    }

    function verifyOTP() {
        const code = document.getElementById('otp').value;
        confirmationResult.confirm(code).then(() => {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('app-main').style.display = 'grid';
            initPeer();
        }).catch(() => alert("‡¶≠‡ßÅ‡¶≤ ‡¶ì‡¶ü‡¶ø‡¶™‡¶ø!"));
    }

    // ‡ß®. PeerJS ‡¶ì ‡¶ï‡¶≤‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï
    function initPeer() {
        peer = new Peer('user-' + Math.floor(Math.random()*10000));
        peer.on('call', call => {
            document.getElementById('video-grid').style.display = 'grid';
            call.answer(myStream);
            call.on('stream', userStream => addRemoteStream(userStream));
        });
    }

    async function startVideoCall() {
        document.getElementById('video-grid').style.display = 'grid';
        myStream = await navigator.mediaDevices.getUserMedia({video: true, audio: true});
        document.getElementById('local-video').srcObject = myStream;
        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡ßá‡¶∞ ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶ü‡ßã ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü
    }

    function addRemoteStream(stream) {
        const v = document.createElement('video');
        v.srcObject = stream;
        v.autoplay = true;
        v.playsinline = true;
        document.getElementById('video-grid').append(v);
    }

    // ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function sendMessage() {
        const input = document.getElementById('msg-input');
        if(!input.value) return;
        const msgDiv = document.createElement('div');
        msgDiv.className = 'msg sent';
        msgDiv.innerText = input.value;
        document.getElementById('messages').appendChild(msgDiv);
        input.value = '';
        document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    }

    function endCall() {
        location.reload();
    }

    function openChat(name) {
        document.body.classList.add('active-chat');
        document.getElementById('current-chat-name').innerText = name;
    }

    function closeChat() {
        document.body.classList.remove('active-chat');
    }
</script>

</body>
</html>
