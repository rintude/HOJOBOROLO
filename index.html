<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
    *{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#0b0b12;color:#fff}
header{text-align:center;padding:14px;font-size:22px;font-weight:700;
background:linear-gradient(90deg,#ff004c,#ff7b00)}
.container{max-width:900px;margin:auto;padding:12px}
.card{background:#151521;border-radius:14px;padding:16px;margin-bottom:14px}
input,button{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:none;font-size:16px}
input{background:#0f0f18;color:#fff}
button{background:linear-gradient(90deg,#ff004c,#ff7b00);color:#fff;font-weight:600}
button.secondary{background:linear-gradient(90deg,#0077ff,#00e0ff)}
button.danger{background:#ff0033}
.chat{height:240px;overflow-y:auto;background:#0f0f18;border-radius:10px;padding:10px}
video{width:100%;max-height:220px;background:#000;border-radius:12px;margin-top:10px}
.controls{display:flex;gap:10px;flex-wrap:wrap}
#incoming{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);
align-items:center;justify-content:center}
#incoming .box{background:#1a1a2b;padding:20px;border-radius:14px;text-align:center}
</style>
</head>

<body>

<header>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</header>

<div class="container">

<div class="card" id="login">
<input id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
<input id="roomCode" placeholder="‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶ï‡ßã‡¶°">
<button onclick="createRoom()">‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<button class="secondary" onclick="joinRoom()">‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div class="card" id="chatCard" style="display:none">
<div class="chat" id="chat"></div>
<input id="msg" placeholder="‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
<button onclick="sendMsg()">‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
</div>

<div class="card" id="callCard" style="display:none">
<video id="myVideo" autoplay muted playsinline></video>
<video id="remoteVideo" autoplay playsinline></video>
<div class="controls">
<button onclick="startCall()">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ï‡¶≤</button>
<button onclick="toggleMic()">‡¶Æ‡¶æ‡¶á‡¶ï</button>
<button onclick="toggleCam()">‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</button>
<button class="danger" onclick="leaveRoom()">‡¶¨‡ßá‡¶∞‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®</button>
</div>
</div>

</div>

<div id="incoming">
<div class="box">
<div id="callerText"></div>
<button onclick="acceptCall()">‡¶ï‡¶≤ ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<button class="danger" onclick="rejectCall()">‡¶∞‡¶ø‡¶ú‡ßá‡¶ï‡ßç‡¶ü</button>
</div>
</div>

<script>
let peer,conn,call,pendingCall,localStream;
let myName="",peerName="",isHost=false;

function log(t){chat.innerHTML+=`<div>${t}</div>`;chat.scrollTop=chat.scrollHeight}
function enter(){
login.style.display="none";
chatCard.style.display="block";
callCard.style.display="block";
}

function createRoom(){
myName=username.value; isHost=true;
peer=new Peer(roomCode.value,{
config:{
iceServers:[
{urls:"stun:stun.l.google.com:19302"},
{urls:"stun:stun1.l.google.com:19302"}
]
}
});
peer.on("open",()=>{enter();log("üü¢ ‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá")});
peer.on("connection",c=>{
conn=c; peerName=c.metadata?.name||"‡¶è‡¶ï‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞";
alert(peerName+" ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá");
log("üü° "+peerName+" ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá");
setupConn();
});
peer.on("call",incomingCall);
}

function joinRoom(){
myName=username.value;
peer=new Peer({
config:{
iceServers:[
{urls:"stun:stun.l.google.com:19302"},
{urls:"stun:stun1.l.google.com:19302"}
]
}
});
peer.on("open",()=>{
conn=peer.connect(roomCode.value,{metadata:{name:myName}});
conn.on("open",()=>{enter();log("üü¢ ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá")});
setupConn();
});
peer.on("call",incomingCall);
}

function setupConn(){
conn.on("data",d=>log(`<b>${d.name}:</b> ${d.msg}`));
conn.on("close",()=>{
if(isHost){
alert(peerName+" ‡¶∞‡ßÅ‡¶Æ ‡¶õ‡ßá‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá");
log("üî¥ "+peerName+" ‡¶∞‡ßÅ‡¶Æ ‡¶õ‡ßá‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá");
}});
}

function sendMsg(){
conn.send({name:myName,msg:msg.value});
log("<b>‡¶Ü‡¶Æ‡¶ø:</b> "+msg.value); msg.value="";
}

function incomingCall(c){
pendingCall=c;
callerText.innerText=peerName+" ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶õ‡ßá";
incoming.style.display="flex";
}

function acceptCall(){
incoming.style.display="none";
navigator.mediaDevices.getUserMedia({video:true,audio:true})
.then(s=>{
localStream=s;
myVideo.srcObject=s;
pendingCall.answer(s);
pendingCall.on("stream",r=>remoteVideo.srcObject=r);
call=pendingCall; pendingCall=null;
});
}

function rejectCall(){pendingCall.close();pendingCall=null;incoming.style.display="none"}
function startCall(){
navigator.mediaDevices.getUserMedia({video:true,audio:true})
.then(s=>{
localStream=s;
myVideo.srcObject=s;
call=peer.call(conn.peer,s);
call.on("stream",r=>remoteVideo.srcObject=r);
});
}
function toggleMic(){localStream.getAudioTracks()[0].enabled^=1}
function toggleCam(){localStream.getVideoTracks()[0].enabled^=1}
function leaveRoom(){location.reload()}
</script>

<footer style="text-align:center;opacity:.6;padding:10px">
¬© 2025 ‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ | ‡¶¨‡¶æ‡¶¨‡¶æ‡¶á
</footer>

</body>
</html>
