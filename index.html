<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</title>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:system-ui,sans-serif;
    background:radial-gradient(circle at top,#1e1e2f,#05050a);
    color:#fff;
}

/* SPLASH */
#splash{
    position:fixed; inset:0;
    background:linear-gradient(135deg,#ff004c,#ff7b00);
    display:flex; align-items:center; justify-content:center;
    font-size:48px; font-weight:800;
    letter-spacing:6px;
    animation:fadeZoom 1.8s ease forwards;
    z-index:10;
}
@keyframes fadeZoom{
    0%{opacity:0;transform:scale(.8)}
    40%{opacity:1;transform:scale(1.05)}
    100%{opacity:0}
}

#app{display:none;height:100vh;overflow:auto}

header{
    text-align:center;
    padding:14px;
    font-size:22px;
    font-weight:700;
    background:linear-gradient(90deg,#ff004c,#ff7b00);
}

.container{
    max-width:900px;
    margin:auto;
    padding:12px;
}

.card{
    background:#141421;
    border-radius:14px;
    padding:16px;
    margin-bottom:14px;
    box-shadow:0 0 25px rgba(0,0,0,.6);
}

input,button{
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:10px;
    border:none;
    font-size:16px;
}

input{
    background:#0e0e18;
    color:#fff;
}

button{
    background:linear-gradient(90deg,#ff004c,#ff7b00);
    color:#fff;
    font-weight:600;
}
button.secondary{
    background:linear-gradient(90deg,#0077ff,#00e0ff);
}
button.danger{background:#ff0033}

.chat{
    height:240px;
    overflow-y:auto;
    background:#0e0e18;
    border-radius:10px;
    padding:10px;
}

video{
    width:100%;
    max-height:220px;
    background:#000;
    border-radius:12px;
    margin-top:10px;
}

.controls{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}

footer{
    text-align:center;
    font-size:12px;
    opacity:.6;
    padding:10px;
}
</style>
</head>

<body>

<div id="splash">‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</div>

<div id="app">
<header>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</header>

<div class="container">

<!-- LOGIN -->
<div class="card" id="login">
    <input id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
    <input id="roomCode" placeholder="‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶ï‡ßã‡¶°">
    <button onclick="createRoom()">‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <button class="secondary" onclick="joinRoom()">‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<!-- CHAT -->
<div class="card" id="chatCard" style="display:none">
    <div class="chat" id="chat"></div>
    <input id="msg" placeholder="‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
    <button onclick="sendMsg()">‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
</div>

<!-- CALL -->
<div class="card" id="callCard" style="display:none">
    <video id="myVideo" autoplay muted playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
    <div class="controls">
        <button onclick="startCall()">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ï‡¶≤</button>
        <button onclick="toggleMic()">‡¶Æ‡¶æ‡¶á‡¶ï</button>
        <button onclick="toggleCam()">‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</button>
        <button class="danger" onclick="leaveRoom()">‡¶¨‡ßá‡¶∞‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®</button>
    </div>
</div>

</div>

<footer>¬© 2025 ‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ | ‡¶¨‡¶æ‡¶¨‡¶æ‡¶á</footer>
</div>

<script>
/* SPLASH */
setTimeout(()=>{
    splash.style.display="none";
    app.style.display="block";
},1800);

/* STATE */
let peer, conn=null, currentCall=null;
let localStream=null;
let isHost=false;

/* LOG */
function log(t){
    chat.innerHTML+=`<div>${t}</div>`;
    chat.scrollTop=chat.scrollHeight;
}

/* ENTER */
function enter(){
    login.style.display="none";
    chatCard.style.display="block";
    callCard.style.display="block";
}

/* CREATE */
function createRoom(){
    if(!username.value||!roomCode.value) return alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®");
    isHost=true;
    peer=new Peer(roomCode.value);

    peer.on("open",()=>{
        enter();
        log("üü¢ ‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá");
    });

    peer.on("connection",c=>{
        conn=c;
        setupConnection();
        alert("‡¶è‡¶ï‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá");
        log("üü° ‡¶è‡¶ï‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá");
    });

    peer.on("call",handleCall);
}

/* JOIN */
function joinRoom(){
    if(!username.value||!roomCode.value) return alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®");
    isHost=false;
    peer=new Peer();

    peer.on("open",()=>{
        conn=peer.connect(roomCode.value);
        conn.on("open",()=>{
            enter();
            log("üü¢ ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
        });
        setupConnection();
    });

    peer.on("call",handleCall);
}

/* CONNECTION */
function setupConnection(){
    if(!conn) return;

    conn.on("data",d=>{
        log(`<b>${d.name}:</b> ${d.msg}`);
    });

    conn.on("close",()=>{
        if(isHost){
            alert("‡¶è‡¶ï‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∞‡ßÅ‡¶Æ ‡¶õ‡ßá‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá");
            log("üî¥ ‡¶è‡¶ï‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∞‡ßÅ‡¶Æ ‡¶õ‡ßá‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá");
        }
    });
}

/* CHAT */
function sendMsg(){
    if(!conn||!msg.value) return;
    conn.send({name:username.value,msg:msg.value});
    log(`<b>‡¶Ü‡¶Æ‡¶ø:</b> ${msg.value}`);
    msg.value="";
}

/* CALL RECEIVE */
function handleCall(call){
    if(currentCall) return;
    currentCall=call;

    navigator.mediaDevices.getUserMedia({video:true,audio:true})
    .then(stream=>{
        localStream=stream;
        myVideo.srcObject=stream;
        call.answer(stream);
        call.on("stream",r=>remoteVideo.srcObject=r);
        call.on("close",()=>currentCall=null);
    })
    .catch(()=>alert("Camera/Mic permission ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ"));
}

/* CALL START (ANYONE) */
function startCall(){
    if(!conn||currentCall) return;
    navigator.mediaDevices.getUserMedia({video:true,audio:true})
    .then(stream=>{
        localStream=stream;
        myVideo.srcObject=stream;
        currentCall=peer.call(conn.peer,stream);
        currentCall.on("stream",r=>remoteVideo.srcObject=r);
        currentCall.on("close",()=>currentCall=null);
    })
    .catch(()=>alert("Camera/Mic permission ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ"));
}

/* TOGGLES */
function toggleMic(){
    if(localStream) localStream.getAudioTracks()[0].enabled^=1;
}
function toggleCam(){
    if(localStream) localStream.getVideoTracks()[0].enabled^=1;
}

/* LEAVE */
function leaveRoom(){
    if(currentCall) currentCall.close();
    if(conn) conn.close();
    if(peer) peer.destroy();
    location.reload();
}
</script>

</body>
</html>
