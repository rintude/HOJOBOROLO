<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤ - Moto HD</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root {
            --wa-teal: #075E54;
            --wa-green: #25D366;
            --wa-bg: #e5ddd5;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

        body { 
            margin: 0; background-color: #d1d7db; 
            display: flex; justify-content: center; 
            height: 100vh; overflow: hidden; 
        }

        /* ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® */
        #splash-screen {
            position: fixed; inset: 0; background: white;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10000; transition: opacity 0.5s;
        }

        .app-container {
            width: 100%; max-width: 500px; height: 100vh;
            background: var(--wa-bg); display: flex; flex-direction: column; 
            position: relative; overflow: hidden;
        }

        header {
            background: var(--wa-teal); padding: 15px; color: white;
            text-align: center; font-weight: bold; font-size: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 10;
        }

        .screen { display: none; flex-direction: column; height: 100%; overflow: hidden; }
        .active { display: flex; }

        /* ‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡¶ï‡ßç‡¶∏ */
        .login-box { margin: auto; width: 85%; background: white; padding: 25px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; outline: none; }
        .start-btn { width: 100%; padding: 12px; background: var(--wa-green); color: white; border: none; font-weight: bold; border-radius: 5px; cursor: pointer; }

        /* ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
        .video-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 10px; background: #000; flex-shrink: 0; }
        video { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; background: #222; }

        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶è‡¶∞‡¶ø‡ßü‡¶æ - ‡¶è‡¶ü‡¶ø ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶¶‡¶ñ‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá */
        #chat-content {
            flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
            margin-bottom: 5px;
        }
        .msg { max-width: 80%; margin-bottom: 8px; padding: 8px 12px; border-radius: 10px; font-size: 14px; box-shadow: 0 1px 1px rgba(0,0,0,0.1); word-wrap: break-word; }
        .msg-you { align-self: flex-end; background: #dcf8c6; }
        .msg-them { align-self: flex-start; background: #ffffff; }

        /* ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ - ‡¶Ø‡¶æ‡¶§‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶®‡¶æ ‡¶Ø‡¶æ‡ßü */
        .call-controls {
            background: #f0f0f0; padding: 10px; border-top: 1px solid #ddd;
            flex-shrink: 0; /* ‡¶è‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ï‡ßÅ‡¶ö‡¶ø‡¶§ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ */
        }
        
        .message-input-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .message-input-row input { margin: 0; border-radius: 25px; border: 1px solid #ccc; padding: 10px 15px; flex: 1; }
        .send-btn { width: 40px; height: 40px; background: var(--wa-teal); border: none; border-radius: 50%; color: white; cursor: pointer; font-size: 18px; }

        .action-buttons-row {
            display: flex; justify-content: space-around; align-items: center; gap: 5px;
        }

        .control-btn {
            flex: 1; padding: 10px 2px; border: none; border-radius: 8px;
            font-size: 12px; font-weight: bold; cursor: pointer; color: white;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
        }

        .btn-mic { background-color: #54656f; }
        .btn-cam { background-color: #54656f; }
        .btn-hangup { background-color: #ea0038; }

        .off { background-color: #ff9800 !important; }

    </style>
</head>
<body>

<div id="splash-screen">
    <div style="font-size: 50px; background: var(--wa-teal); color: white; width: 80px; height: 80px; display: flex; justify-content: center; align-items: center; border-radius: 20px;">‡¶π</div>
    <h2 style="color: #555;">‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤</h2>
</div>

<div class="app-container">
    <header>‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤</header>

    <div id="login-screen" class="screen active">
        <div class="login-box">
            <h3 style="color: var(--wa-teal)">Moto HD Login</h3>
            <input type="text" id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <input type="text" id="room-id" placeholder="‡¶∞‡ßÅ‡¶Æ ‡¶Ü‡¶á‡¶°‡¶ø (ID)">
            <button class="start-btn" onclick="joinRoom()">‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="main-screen" class="screen">
        <div class="video-grid">
            <video id="local-video" autoplay muted playsinline></video>
            <video id="remote-video" autoplay playsinline></video>
        </div>

        <div id="chat-content"></div>

        <div class="call-controls">
            <div class="message-input-row">
                <input type="text" id="msg-input" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                <button class="send-btn" onclick="sendMessage()">‚û§</button>
            </div>

            <div class="action-buttons-row">
                <button id="mic-btn" class="control-btn btn-mic" onclick="toggleMic()">
                    <span>üé§</span> ‡¶Æ‡¶æ‡¶á‡¶ï
                </button>
                <button id="cam-btn" class="control-btn btn-cam" onclick="toggleVideo()">
                    <span>üì∑</span> ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ
                </button>
                <button class="control-btn btn-hangup" onclick="exitRoom()">
                    <span>üìû</span> ‡¶≤‡¶ø‡¶≠
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠
    setTimeout(() => {
        const splash = document.getElementById('splash-screen');
        if(splash) {
            splash.style.opacity = '0';
            setTimeout(() => splash.remove(), 500);
        }
    }, 2000);

    let peer, localStream, conn;
    let isMicOn = true;
    let isCamOn = true;

    function joinRoom() {
        const name = document.getElementById('username').value;
        const room = document.getElementById('room-id').value;
        if (!name || !room) return alert("‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶®");

        peer = new Peer('hjb-' + room);

        peer.on('open', () => {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('main-screen').classList.add('active');
            startMedia();
        });

        peer.on('error', (err) => {
            if(err.type === 'unavailable-id') connectAsGuest('hjb-' + room);
        });

        peer.on('call', call => {
            call.answer(localStream);
            call.on('stream', stream => {
                document.getElementById('remote-video').srcObject = stream;
            });
        });

        peer.on('connection', c => {
            conn = c;
            conn.on('data', data => appendMsg(data, false));
        });
    }

    function connectAsGuest(id) {
        peer = new Peer('hjb-guest-' + Math.floor(Math.random()*9999));
        peer.on('open', () => {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('main-screen').classList.add('active');
            startMedia().then(() => {
                const call = peer.call(id, localStream);
                call.on('stream', stream => {
                    document.getElementById('remote-video').srcObject = stream;
                });
                conn = peer.connect(id);
                conn.on('data', data => appendMsg(data, false));
            });
        });
    }

    async function startMedia() {
        try {
            localStream = await navigator.mediaDevices.getUserMedia({video: true, audio: true});
            document.getElementById('local-video').srcObject = localStream;
        } catch(e) { console.error("Permission Denied"); }
    }

    function sendMessage() {
        const inp = document.getElementById('msg-input');
        if(conn && inp.value.trim() !== "") {
            conn.send(inp.value);
            appendMsg(inp.value, true);
            inp.value = "";
        }
    }

    function appendMsg(txt, isMe) {
        const div = document.createElement('div');
        div.className = isMe ? "msg msg-you" : "msg msg-them";
        div.innerText = txt;
        const box = document.getElementById('chat-content');
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function toggleMic() {
        isMicOn = !isMicOn;
        if(localStream) localStream.getAudioTracks()[0].enabled = isMicOn;
        const btn = document.getElementById('mic-btn');
        btn.innerHTML = isMicOn ? "<span>üé§</span> ‡¶Æ‡¶æ‡¶á‡¶ï" : "<span>üîá</span> ‡¶Æ‡¶ø‡¶â‡¶ü";
        btn.classList.toggle('off', !isMicOn);
    }

    function toggleVideo() {
        isCamOn = !isCamOn;
        if(localStream) localStream.getVideoTracks()[0].enabled = isCamOn;
        const btn = document.getElementById('cam-btn');
        btn.innerHTML = isCamOn ? "<span>üì∑</span> ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ" : "<span>üö´</span> ‡¶Ö‡¶´";
        btn.classList.toggle('off', !isCamOn);
    }

    function exitRoom() {
        if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶≤‡¶ø‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) location.reload();
    }
</script>

</body>
</html>
