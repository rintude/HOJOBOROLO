<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</title>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:system-ui,sans-serif;
    background:radial-gradient(circle at top,#1e1e2f,#05050a);
    color:#fff;
}
#splash{
    position:fixed; inset:0;
    background:linear-gradient(135deg,#ff004c,#ff7b00);
    display:flex; align-items:center; justify-content:center;
    font-size:46px; font-weight:800;
    letter-spacing:6px;
    animation:fadeZoom 1.6s ease forwards;
    z-index:10;
}
@keyframes fadeZoom{
    0%{opacity:0;transform:scale(.85)}
    40%{opacity:1;transform:scale(1.05)}
    100%{opacity:0}
}
#app{display:none;height:100vh;overflow:auto}
header{
    text-align:center;
    padding:14px;
    font-size:22px;
    font-weight:700;
    background:linear-gradient(90deg,#ff004c,#ff7b00);
}
.container{max-width:900px;margin:auto;padding:12px}
.card{
    background:#141421;
    border-radius:14px;
    padding:16px;
    margin-bottom:14px;
}
input,button{
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:10px;
    border:none;
    font-size:16px;
}
input{background:#0e0e18;color:#fff}
button{
    background:linear-gradient(90deg,#ff004c,#ff7b00);
    color:#fff;font-weight:600;
}
button.secondary{background:linear-gradient(90deg,#0077ff,#00e0ff)}
button.danger{background:#ff0033}
.chat{
    height:240px;overflow-y:auto;
    background:#0e0e18;border-radius:10px;padding:10px;
}
video{
    width:100%;max-height:220px;
    background:#000;border-radius:12px;margin-top:10px;
}
.controls{display:flex;gap:10px;flex-wrap:wrap}
footer{text-align:center;font-size:12px;opacity:.6;padding:10px}
</style>
</head>

<body>

<div id="splash">‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</div>

<div id="app">
<header>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</header>

<div class="container">

<div class="card" id="login">
    <input id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
    <input id="roomCode" placeholder="‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶ï‡ßã‡¶°">
    <button onclick="createRoom()">‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <button class="secondary" onclick="joinRoom()">‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div class="card" id="chatCard" style="display:none">
    <div class="chat" id="chat"></div>
    <input id="msg" placeholder="‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
    <button onclick="sendMsg()">‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
</div>

<div class="card" id="callCard" style="display:none">
    <video id="myVideo" autoplay muted playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
    <div class="controls">
        <button onclick="startCall()">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ï‡¶≤</button>
        <button onclick="toggleMic()">‡¶Æ‡¶æ‡¶á‡¶ï</button>
        <button onclick="toggleCam()">‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</button>
        <button class="danger" onclick="leaveRoom()">‡¶¨‡ßá‡¶∞‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®</button>
    </div>
</div>

</div>
<footer>¬© 2025 ‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ | ‡¶¨‡¶æ‡¶¨‡¶æ‡¶á</footer>
</div>

<script>
setTimeout(()=>{splash.style.display="none";app.style.display="block"},1600);

let peer, conn=null, call=null, localStream=null;
let myName="", peerName="", isHost=false;

function log(t){
    chat.innerHTML+=`<div>${t}</div>`;
    chat.scrollTop=chat.scrollHeight;
}

function enter(){
    login.style.display="none";
    chatCard.style.display="block";
    callCard.style.display="block";
}

function createRoom(){
    if(!username.value||!roomCode.value)return alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®");
    myName=username.value; isHost=true;
    peer=new Peer(roomCode.value);
    peer.on("open",()=>{
        enter(); log("üü¢ ‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá");
    });
    peer.on("connection",c=>{
        conn=c;
        setupConn();
    });
    peer.on("call",handleCall);
}

function joinRoom(){
    if(!username.value||!roomCode.value)return alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®");
    myName=username.value;
    peer=new Peer();
    peer.on("open",()=>{
        conn=peer.connect(roomCode.value,{metadata:{name:myName}});
        conn.on("open",()=>{
            enter(); log("üü¢ ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
        });
        setupConn();
    });
    peer.on("call",handleCall);
}

function setupConn(){
    if(!conn)return;
    peerName=conn.metadata?.name||"‡¶è‡¶ï‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞";

    if(isHost){
        alert(peerName+" ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá");
        log("üü° "+peerName+" ‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá");
    }

    conn.on("data",d=>{
        log(`<b>${d.name}:</b> ${d.msg}`);
    });

    conn.on("close",()=>{
        if(isHost){
            alert(peerName+" ‡¶∞‡ßÅ‡¶Æ ‡¶õ‡ßá‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá");
            log("üî¥ "+peerName+" ‡¶∞‡ßÅ‡¶Æ ‡¶õ‡ßá‡ßú‡ßá ‡¶ó‡ßá‡¶õ‡ßá");
        }
    });
}

function sendMsg(){
    if(!conn||!msg.value)return;
    conn.send({name:myName,msg:msg.value});
    log(`<b>‡¶Ü‡¶Æ‡¶ø:</b> ${msg.value}`);
    msg.value="";
}

function handleCall(c){
    call=c;
    getMedia().then(()=>{
        call.answer(localStream);
        call.on("stream",r=>remoteVideo.srcObject=r);
    }).catch(showMediaError);
}

function startCall(){
    if(call||!conn)return;
    getMedia().then(()=>{
        call=peer.call(conn.peer,localStream);
        call.on("stream",r=>remoteVideo.srcObject=r);
    }).catch(showMediaError);
}

function getMedia(){
    return navigator.mediaDevices.getUserMedia({video:true,audio:true})
    .then(s=>{
        localStream=s;
        myVideo.srcObject=s;
    });
}

function showMediaError(e){
    alert("Camera/Mic Error:\n"+e.name+"\n\nHTTPS URL ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡ßá‡¶® ‡¶§‡ßã?");
}

function toggleMic(){
    if(localStream)localStream.getAudioTracks()[0].enabled^=1;
}
function toggleCam(){
    if(localStream)localStream.getVideoTracks()[0].enabled^=1;
}
function leaveRoom(){
    if(call)call.close();
    if(conn)conn.close();
    if(peer)peer.destroy();
    location.reload();
}
</script>

</body>
</html>
