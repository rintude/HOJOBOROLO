<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</title>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:system-ui, sans-serif;
    background:radial-gradient(circle at top,#1e1e2f,#0b0b12);
    color:#fff;
    overflow:hidden;
}

/* SPLASH */
#splash{
    position:fixed;
    inset:0;
    background:radial-gradient(circle,#ff004c,#7a1f1f,#000);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:48px;
    font-weight:800;
    letter-spacing:6px;
    animation:zoomFade 2s ease forwards;
    z-index:10;
}
@keyframes zoomFade{
    0%{transform:scale(0.6);opacity:0}
    50%{transform:scale(1.1);opacity:1}
    100%{transform:scale(1);opacity:0}
}

#app{
    display:none;
    height:100vh;
    overflow:auto;
}

/* LAYOUT */
header{
    text-align:center;
    padding:14px;
    font-size:22px;
    font-weight:700;
    background:linear-gradient(90deg,#ff004c,#ff7b00);
}

.container{
    max-width:900px;
    margin:auto;
    padding:12px;
}

.card{
    background:#151521;
    border-radius:14px;
    padding:16px;
    margin-bottom:14px;
    box-shadow:0 0 25px rgba(0,0,0,.6);
}

input,button{
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:10px;
    border:none;
    font-size:16px;
}

input{
    background:#0f0f18;
    color:#fff;
}

button{
    background:linear-gradient(90deg,#ff004c,#ff7b00);
    color:#fff;
    font-weight:600;
}

button.secondary{
    background:linear-gradient(90deg,#0077ff,#00e0ff);
}

button.danger{
    background:#ff0033;
}

.chat{
    height:240px;
    overflow-y:auto;
    background:#0f0f18;
    border-radius:10px;
    padding:10px;
}

.chat div{
    margin-bottom:6px;
}

video{
    width:100%;
    max-height:220px;
    background:#000;
    border-radius:12px;
    margin-top:10px;
}

.controls{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}

footer{
    text-align:center;
    font-size:12px;
    opacity:.6;
    padding:10px;
}
</style>
</head>

<body>

<div id="splash">‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</div>

<div id="app">
<header>‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤</header>

<div class="container">

<!-- LOGIN -->
<div class="card" id="login">
    <input id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
    <input id="roomCode" placeholder="‡¶∏‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶ü ‡¶ï‡ßã‡¶°">
    <button onclick="createRoom()">‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <button class="secondary" onclick="joinRoom()">‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<!-- CHAT -->
<div class="card" id="chatCard" style="display:none;">
    <div class="chat" id="chat"></div>
    <input id="msg" placeholder="‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
    <button onclick="sendMsg()">‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
</div>

<!-- CALL -->
<div class="card" id="callCard" style="display:none;">
    <video id="myVideo" autoplay muted playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
    <div class="controls">
        <button onclick="startCall()">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ï‡¶≤</button>
        <button onclick="toggleMic()">‡¶Æ‡¶æ‡¶á‡¶ï</button>
        <button onclick="toggleCam()">‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</button>
        <button class="danger" onclick="leave()">‡¶¨‡ßá‡¶∞‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶®</button>
    </div>
</div>

</div>

<footer>¬© 2025 ‡¶π ‡¶ú ‡¶¨ ‡¶∞ ‡¶≤ | ‡¶¨‡¶æ‡¶¨‡¶æ‡¶á</footer>
</div>

<script>
/* SPLASH */
setTimeout(()=>{
    splash.style.display="none";
    app.style.display="block";
},2000);

/* STATE */
let peer, conn, call;
let localStream;
let isCreator=false;

/* LOG */
function log(t){
    chat.innerHTML+=`<div>${t}</div>`;
    chat.scrollTop=chat.scrollHeight;
}

/* CREATE */
function createRoom(){
    isCreator=true;
    const r=roomCode.value.trim();
    if(!username.value||!r)return alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®");

    peer=new Peer(r);

    peer.on("open",()=>enter("‡¶∞‡ßÅ‡¶Æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá"));
    peer.on("connection",c=>{conn=c;setupChat()});
    peer.on("call",receiveCall);
}

/* JOIN */
function joinRoom(){
    isCreator=false;
    const r=roomCode.value.trim();
    if(!username.value||!r)return alert("‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®");

    peer=new Peer();
    peer.on("open",()=>{
        conn=peer.connect(r);
        conn.on("open",()=>{
            setupChat();
            enter("‡¶∞‡ßÅ‡¶Æ‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
        });
    });
    peer.on("call",receiveCall);
}

/* ENTER */
function enter(msg){
    login.style.display="none";
    chatCard.style.display="block";
    callCard.style.display="block";
    log("üü¢ "+msg);
}

/* CHAT */
function setupChat(){
    conn.on("data",d=>{
        log("<b>"+d.name+":</b> "+d.msg);
    });
}

function sendMsg(){
    if(!conn||!msg.value)return;
    conn.send({name:username.value,msg:msg.value});
    log("<b>‡¶Ü‡¶Æ‡¶ø:</b> "+msg.value);
    msg.value="";
}

/* CALL RECEIVE */
function receiveCall(c){
    call=c;
    navigator.mediaDevices.getUserMedia({video:true,audio:true})
    .then(s=>{
        localStream=s;
        myVideo.srcObject=s;
        c.answer(s);
        c.on("stream",r=>remoteVideo.srcObject=r);
    })
    .catch(()=>alert("Camera/Mic blocked"));
}

/* CALL START */
function startCall(){
    if(isCreator)return alert("‡¶Ö‡¶®‡ßç‡¶Ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶≤ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶¨‡ßá");
    navigator.mediaDevices.getUserMedia({video:true,audio:true})
    .then(s=>{
        localStream=s;
        myVideo.srcObject=s;
        call=peer.call(roomCode.value,s);
        call.on("stream",r=>remoteVideo.srcObject=r);
    })
    .catch(()=>alert("Camera/Mic blocked"));
}

/* TOGGLES */
function toggleMic(){
    if(localStream)localStream.getAudioTracks()[0].enabled^=1;
}
function toggleCam(){
    if(localStream)localStream.getVideoTracks()[0].enabled^=1;
}

/* LEAVE */
function leave(){
    if(call)call.close();
    if(conn)conn.close();
    if(peer)peer.destroy();
    location.reload();
}
</script>

</body>
</html>
