<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤ - Moto HD Edition</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        /* ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶° ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® */
        :root {
            --brand-primary: #075E54; /* Moto HD / WhatsApp Teal */
            --brand-secondary: #128C7E;
            --bg-color: #e5ddd5;
            --chat-self: #dcf8c6;
            --chat-other: #ffffff;
        }

        * { 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0; padding: 0;
            background-color: #d1d7db;
            display: flex; justify-content: center;
            height: 100vh; overflow: hidden;
        }

        /* ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® */
        #splash-screen {
            position: fixed; inset: 0;
            background: #ffffff;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }
        .splash-logo {
            width: 80px; height: 80px;
            background: var(--brand-primary);
            color: white; border-radius: 20px;
            display: flex; justify-content: center; align-items: center;
            font-size: 40px; font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .splash-text { margin-top: 15px; font-size: 24px; color: #555; font-weight: bold; }

        /* ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        .app-container {
            width: 100%; max-width: 500px;
            height: 100vh;
            background: var(--bg-color);
            display: flex; flex-direction: column;
            position: relative;
        }

        header {
            background: var(--brand-primary);
            padding: 10px 15px;
            display: flex; align-items: center;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .header-logo {
            width: 40px; height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%; display: flex;
            justify-content: center; align-items: center;
            font-weight: bold; font-size: 20px;
        }

        .header-info { flex-grow: 1; margin-left: 12px; }
        .header-info h4 { margin: 0; font-size: 18px; }
        .header-info span { font-size: 12px; opacity: 0.8; }

        .screen { display: none; flex-direction: column; height: calc(100vh - 60px); }
        .active { display: flex; }

        /* ‡¶≤‡¶ó‡¶á‡¶® ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        .login-box { margin: auto; width: 85%; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; }
        input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border: 1px solid #ddd; border-radius: 8px; outline: none; font-size: 16px;
        }
        .start-btn {
            width: 100%; padding: 12px; background: #25D366;
            color: white; border: none; font-weight: bold;
            border-radius: 8px; cursor: pointer; font-size: 16px;
        }

        /* ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶∞‡¶ø‡ßü‡¶æ */
        .video-wrapper {
            display: grid; grid-template-columns: 1fr 1fr; gap: 5px;
            padding: 10px; background: #000;
        }
        video {
            width: 100%; aspect-ratio: 1/1; object-fit: cover;
            border-radius: 10px; background: #222;
        }

        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ‡¶¨‡¶≤ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        #chat-content {
            flex-grow: 1; padding: 15px; overflow-y: auto;
            display: flex; flex-direction: column;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
        }
        .msg { 
            max-width: 80%; margin-bottom: 8px; padding: 8px 12px; 
            border-radius: 10px; font-size: 14px; position: relative;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        .msg-you { align-self: flex-end; background: var(--chat-self); color: #000; }
        .msg-them { align-self: flex-start; background: var(--chat-other); color: #000; }

        /* ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ */
        .controls {
            padding: 10px; background: #f0f0f0;
            display: flex; flex-direction: column; gap: 10px;
        }
        .input-row { display: flex; gap: 8px; }
        .input-row input { margin-bottom: 0; border-radius: 20px; border: none; padding: 10px 15px; flex: 1; }
        .send-btn { 
            width: 45px; height: 45px; background: var(--brand-primary); 
            border: none; border-radius: 50%; color: white; cursor: pointer;
        }

        .btn-row { display: flex; justify-content: space-around; padding: 5px 0; }
        .action-btn { 
            background: none; border: none; font-size: 11px; color: #555;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .btn-exit { color: #d32f2f; }
    </style>
</head>
<body>

<div id="splash-screen">
    <div class="splash-logo">‡¶π</div>
    <div class="splash-text">‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤</div>
    <div style="position: absolute; bottom: 50px; color: #888; font-size: 12px;">Moto HD Technology</div>
</div>

<div class="app-container">
    <header>
        <div class="header-logo">‡¶π</div>
        <div class="header-info">
            <h4 id="display-name">‡¶π ‡¶Ø ‡¶¨ ‡¶∞ ‡¶≤</h4>
            <span id="status">‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®</span>
        </div>
    </header>

    <div id="login-screen" class="screen active">
        <div class="login-box">
            <h2 style="color: var(--brand-primary); margin-top: 0;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <input type="text" id="username" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <input type="text" id="room-id" placeholder="‡¶∞‡ßÅ‡¶Æ ‡¶Ü‡¶á‡¶°‡¶ø">
            <button class="start-btn" onclick="joinRoom()">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <div id="main-screen" class="screen">
        <div class="video-wrapper">
            <video id="local-video" autoplay muted playsinline></video>
            <video id="remote-video" autoplay playsinline></video>
        </div>

        <div id="chat-content"></div>

        <div class="controls">
            <div class="input-row">
                <input type="text" id="msg-input" placeholder="‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                <button class="send-btn" onclick="sendMessage()">‚û§</button>
            </div>
            <div class="btn-row">
                <button class="action-btn" onclick="toggleMic()" id="mic-btn">üéôÔ∏è<br>‡¶Æ‡¶æ‡¶á‡¶ï</button>
                <button class="action-btn" onclick="toggleVideo()" id="cam-btn">üìπ<br>‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</button>
                <button class="action-btn btn-exit" onclick="exitRoom()">üìû<br>‡¶≤‡¶ø‡¶≠</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ (X ‡¶≤‡¶ú‡¶ø‡¶ï)
    window.onload = () => {
        setTimeout(() => {
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = '0';
            setTimeout(() => splash.remove(), 500);
        }, 2500);
    };

    let peer, localStream, conn;

    function joinRoom() {
        const name = document.getElementById('username').value;
        const room = document.getElementById('room-id').value;
        if (!name || !room) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");

        document.getElementById('display-name').innerText = name;
        peer = new Peer('hjb-' + room);

        peer.on('open', (id) => {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('main-screen').classList.add('active');
            startMedia();
        });

        peer.on('error', (err) => {
            if(err.type === 'unavailable-id') connectAsGuest('hjb-' + room);
        });

        peer.on('call', call => {
            call.answer(localStream);
            call.on('stream', stream => {
                document.getElementById('remote-video').srcObject = stream;
            });
        });

        peer.on('connection', c => {
            conn = c;
            conn.on('data', data => appendMsg(data, false));
        });
    }

    function connectAsGuest(id) {
        const guestId = 'hjb-guest-' + Math.floor(Math.random()*1000);
        peer = new Peer(guestId);
        peer.on('open', () => {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('main-screen').classList.add('active');
            startMedia().then(() => {
                const call = peer.call(id, localStream);
                call.on('stream', stream => {
                    document.getElementById('remote-video').srcObject = stream;
                });
                conn = peer.connect(id);
                conn.on('data', data => appendMsg(data, false));
            });
        });
    }

    async function startMedia() {
        try {
            localStream = await navigator.mediaDevices.getUserMedia({video: true, audio: true});
            document.getElementById('local-video').srcObject = localStream;
        } catch(e) { console.log("Media Error"); }
    }

    function sendMessage() {
        const inp = document.getElementById('msg-input');
        if(conn && inp.value) {
            conn.send(inp.value);
            appendMsg(inp.value, true);
            inp.value = "";
        }
    }

    function appendMsg(txt, isMe) {
        const div = document.createElement('div');
        div.className = isMe ? "msg msg-you" : "msg msg-them";
        div.innerText = txt;
        const box = document.getElementById('chat-content');
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function toggleMic() {
        const audio = localStream.getAudioTracks()[0];
        audio.enabled = !audio.enabled;
        document.getElementById('mic-btn').innerHTML = audio.enabled ? "üéôÔ∏è<br>‡¶Æ‡¶æ‡¶á‡¶ï" : "üîá<br>‡¶Æ‡¶ø‡¶â‡¶ü";
    }

    function toggleVideo() {
        const video = localStream.getVideoTracks()[0];
        video.enabled = !video.enabled;
        document.getElementById('cam-btn').innerHTML = video.enabled ? "üìπ<br>‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ" : "üö´<br>‡¶Ö‡¶´";
    }

    function exitRoom() {
        if(confirm("‡¶ï‡¶≤‡¶ü‡¶ø ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) location.reload();
    }
</script>

</body>
</html>
